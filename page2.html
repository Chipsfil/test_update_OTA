<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Electron OTA Test - Settings</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>
        <img src="assets/logo.png" alt="Logo" class="logo">
        Electron OTA Update Test
      </h1>
    </header>

    <nav>
      <button class="nav-btn" data-page="home">Home</button>
      <button class="nav-btn active" data-page="page2">Settings</button>
      <button class="nav-btn" onclick="window.electron.checkForUpdate()">Check Updates</button>
    </nav>

    <main>
      <div class="card">
        <h2>Settings & Information</h2>
        
        <h3 style="color: #333;">Application Information</h3>
        <div class="status-box">
          <p><strong>App Name:</strong> Electron OTA Test</p>
          <p><strong>Version:</strong> <span id="version-info">Loading...</span></p>
          <p><strong>Platform:</strong> <span id="platform-info">Loading...</span></p>
          <p><strong>Node Version:</strong> <span id="node-version">Loading...</span></p>
        </div>

        <h3 style="margin-top: 20px; color: #333;">Update Configuration</h3>
        <div class="status-box info">
          <p><strong>Update Provider:</strong> GitHub Releases</p>
          <p><strong>Check on Startup:</strong> Yes</p>
          <p><strong>Auto-Download Updates:</strong> Yes</p>
          <p><strong>Installation Method:</strong> Quit and Install</p>
        </div>

        <h3 style="margin-top: 20px; color: #333;">GitHub Release Configuration</h3>
        <div class="card" style="background: #f5f5f5; margin: 15px 0;">
          <p style="color: #666; font-family: monospace; margin-bottom: 10px;">
            "publish": {<br>
            &nbsp;&nbsp;"provider": "github",<br>
            &nbsp;&nbsp;"owner": "yourusername",<br>
            &nbsp;&nbsp;"repo": "electron-ota-test"<br>
            }
          </p>
          <p style="color: #999; font-size: 12px;">Update this configuration in package.json with your GitHub details</p>
        </div>

        <h3 style="margin-top: 20px; color: #333;">Update Status</h3>
        <div id="update-info" class="status-box info">
          <p>Last check: <span id="last-check">Never</span></p>
          <p id="update-message" style="display: none;"></p>
        </div>

        <h3 style="margin-top: 20px; color: #333;">Actions</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
          <button onclick="window.electron.checkForUpdate()">Check for Updates</button>
          <button onclick="location.reload()">Reload App</button>
          <button onclick="window.electron.installUpdate()" style="background: #22c55e;">Install Update (if available)</button>
        </div>

        <h3 style="margin-top: 20px; color: #333;">Troubleshooting Guide</h3>
        <div style="background: #fffbea; padding: 15px; border-radius: 4px; border-left: 4px solid #f59e0b;">
          <h4 style="color: #333; margin-bottom: 10px;">Common Issues:</h4>
          <ul style="margin-left: 20px; color: #666; line-height: 1.8;">
            <li><strong>Updates not detected:</strong> Check that the GitHub repository URL is correct in package.json</li>
            <li><strong>Updates fail to download:</strong> Ensure GitHub releases are properly published with asset files</li>
            <li><strong>Version stays the same:</strong> New version must be higher than current version in package.json</li>
            <li><strong>Installation fails:</strong> Check that the application has write permissions to its directory</li>
            <li><strong>No error messages:</strong> Open DevTools (F12) to see detailed error logs</li>
          </ul>
        </div>

        <h3 style="margin-top: 20px; color: #333;">Build & Publish Commands</h3>
        <div style="background: #f3f4f6; padding: 15px; border-radius: 4px; font-family: monospace; font-size: 12px; line-height: 1.6;">
          <p style="color: #666;">
            <strong># Build the application</strong><br>
            npm run build<br>
            <br>
            <strong># Build and publish to GitHub</strong><br>
            npm run publish<br>
            <br>
            <strong># Build for specific platform (macOS)</strong><br>
            npm run build -- --mac
          </p>
        </div>
      </div>
    </main>

    <div class="version-info">
      App Version: <span id="footer-version">Loading...</span>
    </div>
  </div>

  <script>
    // Load version on page load
    window.electron.getVersion().then(version => {
      document.getElementById('version-info').textContent = version;
      document.getElementById('footer-version').textContent = version;
    });

    // Load platform info
    document.getElementById('platform-info').textContent = navigator.platform;
    document.getElementById('node-version').textContent = process.version || 'N/A';

    // Update status listeners
    window.electron.onUpdateAvailable(() => {
      const updateInfo = document.getElementById('update-info');
      updateInfo.className = 'status-box info';
      const msgElement = updateInfo.querySelector('#update-message') || document.createElement('p');
      msgElement.id = 'update-message';
      msgElement.textContent = '✓ Update available and downloading...';
      msgElement.style.display = 'block';
      if (!updateInfo.querySelector('#update-message')) {
        updateInfo.appendChild(msgElement);
      }
    });

    window.electron.onUpdateDownloaded(() => {
      const updateInfo = document.getElementById('update-info');
      updateInfo.className = 'status-box success';
      const msgElement = updateInfo.querySelector('#update-message') || document.createElement('p');
      msgElement.id = 'update-message';
      msgElement.textContent = '✓ Update downloaded! Click "Install Update" to apply the changes.';
      msgElement.style.display = 'block';
      if (!updateInfo.querySelector('#update-message')) {
        updateInfo.appendChild(msgElement);
      }
    });

    window.electron.onUpdateError((message) => {
      const updateInfo = document.getElementById('update-info');
      updateInfo.className = 'status-box error';
      const msgElement = updateInfo.querySelector('#update-message') || document.createElement('p');
      msgElement.id = 'update-message';
      msgElement.textContent = '✗ Update error: ' + message;
      msgElement.style.display = 'block';
      if (!updateInfo.querySelector('#update-message')) {
        updateInfo.appendChild(msgElement);
      }
    });

    // Update last check time
    document.getElementById('last-check').textContent = new Date().toLocaleString();
  </script>
</body>
</html>
